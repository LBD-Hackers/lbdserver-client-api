{"version":3,"sources":["../../src/LbdProject.ts"],"names":["LbdProject","session","accessPoint","verbose","endsWith","fetch","localProject","projectId","split","length","accessService","AccessService","dataService","DataService","lbdService","LbdService","method","then","result","status","headers","Accept","i","json","data","existingPartialProjects","options","makePublic","local","push","createContainer","aclDefault","ACL","Authorization","agentClass","FOAF","Agent","sparqlUpdate","createRegistryContainer","LBD","hasDatasetRegistry","hasReferenceRegistry","referenceContainerUrl","hasServiceRegistry","part","addPartialProject","q","DCTERMS","creator","info","webId","Object","keys","q0","key","referenceMeta","LbdDataset","create","addDistribution","Buffer","from","init","aggregates","accessRights","read","append","write","control","setResourceAccess","ResourceType","CONTAINER","deleteContainer","getProjectRegistry","repo","partialProjectOfStakeholder","findPartialProject","partialProjectUrl","containerName","property","containerUrl","id","subject","datasetRegistry","datasetUrl","theDataset","ds","datasetId","myEngine","sources","findAllPartialProjects","partials","p","dsReg","query","LDP","contains","results","resultToString","asStream","parsed","bindings","map","value","referenceRegistry","ref","LbdConcept","registries","partial","reg","url","parts","pop","join","identifier","dataset","distribution","rq","DCAT","downloadURL","accessURL","r","b","bi","get","downloadURLs","item","hasReference","inDataset","hasIdentifier","OWL","sameAs","aliases","Set","forEach","add","concept","references","values","v","idQ","inDistribution","response","theConcept","getAllReferenceRegistries"],"mappings":"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","sourcesContent":["import AccessService from \"./helpers/access-service\";\r\nimport DataService from \"./helpers/data-service\";\r\nimport {LbdConcept} from \"./LbdConcept\";\r\nimport {\r\n  newEngine,\r\n  IQueryResultBindings,\r\n  ActorInitSparql,\r\n} from \"@comunica/actor-init-sparql\";\r\nimport {LbdDataset} from \"./LbdDataset\";\r\nimport LBD from \"./helpers/vocab/lbds\";\r\nimport { AccessRights, ResourceType } from \"./helpers/BaseDefinitions\";\r\nimport {LbdService} from \"./LbdService\";\r\nimport { extract, query } from \"./helpers/functions\";\r\nimport { v4 } from \"uuid\";\r\nimport { ACL, DCAT, DCTERMS, FOAF, OWL } from \"@inrupt/vocab-common-rdf\";\r\nimport { Session as BrowserSession } from \"@inrupt/solid-client-authn-browser\";\r\nimport { Session as NodeSession } from \"@inrupt/solid-client-authn-node\";\r\nimport { LDP } from \"@inrupt/vocab-common-rdf\";\r\nimport { getQueryResult, parseStream } from \"./helpers/utils\";\r\n\r\nexport class LbdProject {\r\n  public fetch;\r\n  public verbose: boolean = false;\r\n  public accessService: AccessService;\r\n  public dataService: DataService;\r\n  public lbdService: LbdService;\r\n  public projectId: string;\r\n  public accessPoint: string;\r\n  public data: object[];\r\n\r\n  private session: BrowserSession | NodeSession;\r\n\r\n  // include queryEngine to allow caching of querydata etc.\r\n  public localProject: string;\r\n\r\n  /**\r\n   * \r\n   * @param session an (authenticated) Solid session\r\n   * @param accessPoint The main accesspoint of the project. This is an aggregator containing the different partial projects of the LBDserver instance\r\n   * @param verbose optional parameter for logging purposes\r\n   */\r\n  constructor(\r\n    session: BrowserSession | NodeSession,\r\n    accessPoint: string,\r\n    verbose: boolean = false\r\n  ) {\r\n    if (!accessPoint.endsWith(\"/\")) accessPoint += \"/\";\r\n    this.session = session;\r\n    this.fetch = session.fetch;\r\n    this.accessPoint = accessPoint;\r\n    this.localProject = accessPoint + \"local/\";\r\n    this.verbose = verbose;\r\n    this.projectId = accessPoint.split(\"/\")[accessPoint.split(\"/\").length - 2];\r\n    this.accessService = new AccessService(session.fetch);\r\n    this.dataService = new DataService(session.fetch);\r\n    this.lbdService = new LbdService(session);\r\n  }\r\n\r\n  /**\r\n   * @description Checks whether a project with this access point already exists\r\n   * @returns Boolean: true = the project exists / false = the project doesn't exist\r\n   */\r\n  public async checkExistence() {\r\n    const status = await this.fetch(this.accessPoint, { method: \"HEAD\" }).then(\r\n      (result) => result.status\r\n    );\r\n    if (status === 200) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /** \r\n   * @description Initialize the project in your application. In short, this adds project metadata to your LbdProject instance\r\n   */\r\n  public async init() {\r\n    const data = await this.fetch(this.localProject, {\r\n      headers: { Accept: \"application/ld+json\" },\r\n    }).then((i) => i.json());\r\n    this.data = data;\r\n    return data;\r\n  }\r\n\r\n\r\n  /**\r\n   * @description Create an LBDserver project on your Pod\r\n   * @param existingPartialProjects optional: if the project is already initialized on other stakeholder pods. Adds the existing partial projects to the Pod-specific access point\r\n   * @param options Metadata for the project. To be in format {[predicate]: value}\r\n   * @param makePublic access rights: true = public; false = only the creator\r\n   */\r\n  public async create(\r\n    existingPartialProjects: string[] = [],\r\n    options: object = {},\r\n    makePublic: boolean = false\r\n  ) {\r\n    const local = this.accessPoint + \"local/\";\r\n    existingPartialProjects.push(local);\r\n\r\n    // create global access point\r\n    await this.dataService.createContainer(this.accessPoint, makePublic);\r\n    await this.dataService.createContainer(local, makePublic);\r\n    if (makePublic) {\r\n      let aclDefault = `INSERT {?rule <${ACL.default}> <${local}>} WHERE {?rule a <${ACL.Authorization}> ; <${ACL.agentClass}> <${FOAF.Agent}>}`;\r\n      await this.dataService.sparqlUpdate(local + \".acl\", aclDefault);\r\n    }\r\n\r\n    // create different registries\r\n    await this.createRegistryContainer(\r\n      \"datasets/\",\r\n      makePublic,\r\n      LBD.hasDatasetRegistry\r\n    );\r\n    const referenceContainerUrl = await this.createRegistryContainer(\r\n      \"references/\",\r\n      makePublic,\r\n      LBD.hasReferenceRegistry\r\n    );\r\n    await this.createRegistryContainer(\r\n      \"services/\",\r\n      makePublic,\r\n      LBD.hasServiceRegistry\r\n    );\r\n\r\n    for (const part of existingPartialProjects) {\r\n      await this.addPartialProject(part);\r\n    }\r\n\r\n    let q = `INSERT DATA {<${this.accessPoint}> <${DCTERMS.creator}> \"${this.session.info.webId}\" . }`;\r\n    await this.dataService.sparqlUpdate(local, q);\r\n    await this.dataService.sparqlUpdate(this.accessPoint, q);\r\n\r\n    // create optional metadata (e.g. label etc.)\r\n    if (Object.keys(options).length > 0) {\r\n      let q0 = `INSERT DATA { `;\r\n      for (const key of Object.keys(options)) {\r\n        q0 += `<${this.accessPoint}> <${key}> \"${options[key]}\" .`;\r\n      }\r\n      q0 += \"}\";\r\n      await this.dataService.sparqlUpdate(this.accessPoint, q0);\r\n    }\r\n\r\n    const referenceMeta = new LbdDataset(this.session, referenceContainerUrl);\r\n    await referenceMeta.create();\r\n    await referenceMeta.addDistribution(\r\n      Buffer.from(\"\"),\r\n      \"text/turtle\",\r\n      {},\r\n      \"data\",\r\n      makePublic\r\n    );\r\n    await this.init();\r\n  }\r\n\r\n  /**\r\n   * @description Add a partial project to a Pod-specific access point\r\n   * @param part Partial project to add to a Pod-specific access point\r\n   */\r\n  public async addPartialProject(part: string) {\r\n    const q0 = `INSERT DATA {\r\n        <${this.accessPoint}> <${LBD.aggregates}> <${part}> .\r\n        }`;\r\n    await this.dataService.sparqlUpdate(this.accessPoint, q0);\r\n  }\r\n\r\n  /**\r\n   * @description Add a stakeholder to an LBDserver project\r\n   * @param webId The WebID/card of the stakeholder\r\n   * @param accessRights the access rights this stakeholder should have.\r\n   */\r\n  public async addStakeholder(\r\n    webId: string,\r\n    accessRights: AccessRights = {\r\n      read: true,\r\n      append: false,\r\n      write: false,\r\n      control: false,\r\n    }\r\n  ) {\r\n    await this.accessService.setResourceAccess(\r\n      this.accessPoint,\r\n      accessRights,\r\n      ResourceType.CONTAINER,\r\n      webId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @description delete an LBDserver project (locally)\r\n   */\r\n  public async delete() {\r\n    await this.dataService.deleteContainer(this.accessPoint, true);\r\n  }\r\n\r\n  /**\r\n   * @description find all the partial projects from the indicated project access point\r\n   */\r\n  public async findAllPartialProjects() {\r\n    return await getQueryResult(\r\n      this.accessPoint,\r\n      LBD.aggregates,\r\n      this.fetch,\r\n      false\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @description Find the partial project provided by this stakeholder\r\n   * @param webId The webID of the stakeholder whom's partial project you want to find\r\n   * @returns The URL of the partial project\r\n   */\r\n  public async findPartialProject(webId: string) {\r\n    const repo = await this.lbdService.getProjectRegistry(webId);\r\n    // console.log('repo', repo)\r\n    const partialProjectOfStakeholder = repo + this.projectId + \"/local/\";\r\n    return partialProjectOfStakeholder\r\n    // console.log('partialProjectOfStakeholder', partialProjectOfStakeholder)\r\n    // const status = await this.fetch(partialProjectOfStakeholder, {\r\n    //   method: \"HEAD\",\r\n    // }).then((res) => res.status);\r\n    // if (status === 200) {\r\n    //   return partialProjectOfStakeholder;\r\n    // } else {\r\n    //   throw new Error(\r\n    //     `UNAUTHORIZED: This repository does not exist or you don't have the required access rights`\r\n    //   );\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * @description Add this stakeholder's partial project corresponding with this project (same GUID)\r\n   * @param webId The webID of the stakeholder whom's partial project you want to add\r\n   * @returns the URL of the partial project\r\n   */\r\n  public async addPartialProjectByStakeholder(webId: string) {\r\n    const partialProjectUrl = await this.findPartialProject(webId);\r\n    await this.addPartialProject(partialProjectUrl);\r\n    return partialProjectUrl;\r\n  }\r\n\r\n  private async createRegistryContainer(containerName, makePublic, property) {\r\n    if (!containerName.endsWith(\"/\")) containerName += \"/\";\r\n\r\n    const containerUrl = this.localProject + containerName;\r\n    await this.dataService.createContainer(containerUrl, makePublic);\r\n    const q0 = `INSERT DATA {\r\n        <${this.localProject}> <${property}> <${containerUrl}> .\r\n      }`;\r\n    await this.dataService.sparqlUpdate(this.localProject, q0);\r\n    return containerUrl;\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  /////////////////////// DATASETS ////////////////////////\r\n  /////////////////////////////////////////////////////////\r\n\r\n  /**\r\n   * @description Add a dataset to the project\r\n   * @param makePublic initial access rights for the dataset\r\n   * @param id optional id for the dataset - a GUID is created by default\r\n   * @param options Optional - Object containing metadata about the dataset to be created. e.g: {[RDFS.label]: \"theLabel\"}\r\n   * @returns\r\n   */\r\n  public async addDataset(\r\n    options: object = {},\r\n    makePublic: boolean = false,\r\n    id: string = v4()\r\n  ): Promise<LbdDataset> {\r\n    const subject = extract(this.data, this.localProject);\r\n    const datasetRegistry = subject[LBD.hasDatasetRegistry][0][\"@id\"];\r\n    const datasetUrl = datasetRegistry + id + \"/\";\r\n    const theDataset = new LbdDataset(this.session, datasetUrl);\r\n    await theDataset.create(options, makePublic);\r\n    return theDataset;\r\n  }\r\n\r\n  /**\r\n   * @description Delete a dataset by URL\r\n   * @param datasetUrl The URL of the dataset \r\n   */\r\n  public async deleteDataset(datasetUrl: string) {\r\n    if (!datasetUrl.endsWith(\"/\")) datasetUrl += \"/\";\r\n    const ds = new LbdDataset(this.session, datasetUrl);\r\n    await ds.delete();\r\n  }\r\n\r\n  /**\r\n   * @description delete a dataset by its ID\r\n   * @param datasetId The GUID of the dataset to be deleted\r\n   */\r\n  public async deleteDatasetById(datasetId: string) {\r\n    const subject = extract(this.data, this.localProject);\r\n    const datasetRegistry = subject[LBD.hasDatasetRegistry][0][\"@id\"];\r\n    const datasetUrl = datasetRegistry + datasetId + \"/\";\r\n    const ds = new LbdDataset(this.session, datasetUrl);\r\n    await ds.delete();\r\n  }\r\n\r\n  /**\r\n   * @description Get all datasets within this project\r\n   * @param options {query: query to override, asStream: consume the results as a stream, local: query only the local project}\r\n   * @returns \r\n   */\r\n  public async getAllDatasetUrls(options?: {\r\n    query: string;\r\n    asStream: boolean;\r\n    local: boolean;\r\n  }) {\r\n    const myEngine = newEngine();\r\n    const subject = extract(this.data, this.localProject);\r\n    const sources = [];\r\n    if (options && options.local) {\r\n      sources.push(subject[LBD.hasDatasetRegistry][0][\"@id\"]);\r\n    } else {\r\n      const partials = await this.findAllPartialProjects();\r\n      for (const p of partials) {\r\n        const dsReg = await getQueryResult(\r\n          p,\r\n          LBD.hasDatasetRegistry,\r\n          this.fetch,\r\n          true\r\n        );\r\n        sources.push(dsReg);\r\n      }\r\n    }\r\n    let q;\r\n    if (!options || !options.query) {\r\n      q = `SELECT ?dataset WHERE {?registry <${LDP.contains}> ?dataset}`;\r\n    } else {\r\n      q = options.query;\r\n    }\r\n\r\n    const results = await myEngine.query(q, { sources, fetch: this.fetch });\r\n    const { data } = await myEngine.resultToString(\r\n      results,\r\n      \"application/sparql-results+json\"\r\n    );\r\n    if (options && options.asStream) {\r\n      return data;\r\n    } else {\r\n      const parsed = await parseStream(data);\r\n      return parsed[\"results\"].bindings.map((i) => i[\"dataset\"].value);\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  ////////////////////// REFERENCES////////////////////////\r\n  /////////////////////////////////////////////////////////\r\n\r\n  /**\r\n   * @description Add a concept to the local project registry\r\n   * @returns an LBDconcept Instance\r\n   */\r\n  public async addConcept(id?): Promise<LbdConcept> {\r\n    const subject = extract(this.data, this.localProject);\r\n    const referenceRegistry = subject[LBD.hasReferenceRegistry][0][\"@id\"];\r\n    const ref = new LbdConcept(this.session, referenceRegistry);\r\n    await ref.create(id);\r\n    return ref;\r\n  }\r\n\r\n  public getReferenceRegistry() {\r\n    const subject = extract(this.data, this.localProject);\r\n    return subject[LBD.hasReferenceRegistry][0][\"@id\"];\r\n  }\r\n\r\n  private async getAllReferenceRegistries() {\r\n    const partials = await this.findAllPartialProjects()\r\n    const registries = []\r\n\r\n    for (const partial of partials) {\r\n      const reg = await getQueryResult(partial, LBD.hasReferenceRegistry, this.fetch, true)\r\n      registries.push(reg + \"data\")\r\n    }\r\n\r\n    return registries\r\n  }\r\n\r\n  /**\r\n   * @description delete a concept by ID\r\n   * @param url the URL of the concept to be deleted\r\n   */\r\n  public async deleteConcept(url: string) {\r\n    const parts = url.split(\"/\");\r\n    const id = parts.pop();\r\n    const referenceRegistry = parts.join(\"/\");\r\n    const ref = new LbdConcept(this.session, referenceRegistry);\r\n    await ref.delete();\r\n  }\r\n\r\n  /**\r\n   * @description Find the main concept by one of its representations: an identifier and a dataset\r\n   * @param identifier the Identifier of the representation\r\n   * @param dataset the dataset where the representation resides\r\n   * @param distribution (optional) the distribution of the representation\r\n   * @returns \r\n   */\r\n  public async getConceptByIdentifier(\r\n    identifier: string,\r\n    dataset: string,\r\n    distribution?: string\r\n  ) {\r\n    const myEngine = newEngine();\r\n\r\n    // find all the reference registries of the aggregated partial projects\r\n    const partials = await this.findAllPartialProjects();\r\n    let sources = [];\r\n    for (const p of partials) {\r\n      const referenceRegistry = await getQueryResult(\r\n        p,\r\n        LBD.hasReferenceRegistry,\r\n        this.fetch,\r\n        true\r\n      );\r\n      const rq = `SELECT ?downloadURL ?dist WHERE {<${referenceRegistry}> <${DCAT.distribution}> ?dist . ?dist <${DCAT.downloadURL}> ?downloadURL . OPTIONAL {?dist <${DCAT.accessURL}> ?accessURL .}}`;\r\n      const results = await myEngine\r\n        .query(rq, { sources: [referenceRegistry], fetch: this.fetch })\r\n        .then((r: IQueryResultBindings) => r.bindings())\r\n        .then((b) =>\r\n          b.map((bi) => {\r\n            return {\r\n              downloadURL: bi.get(\"?downloadURL\"),\r\n              accessURL: bi.get(\"?accessURL\"),\r\n            };\r\n          })\r\n        );\r\n      sources = [...sources, ...results];\r\n    }\r\n\r\n    const downloadURLs = sources.map((item) => item.downloadURL.id);\r\n    const q = `SELECT ?concept ?alias WHERE {\r\n      ?concept <${LBD.hasReference}> ?ref .\r\n      ?ref <${LBD.inDataset}> <${dataset}> ;\r\n        <${LBD.hasIdentifier}> ?idUrl .\r\n      ?idUrl <http://schema.org/value> \"${identifier}\" .\r\n      OPTIONAL {?concept <${OWL.sameAs}> ?alias}\r\n  }`;\r\n\r\n    const aliases = new Set<any>();\r\n    await myEngine\r\n      .query(q, { sources: downloadURLs, fetch: this.fetch })\r\n      .then((r: IQueryResultBindings) => r.bindings())\r\n      .then((b) =>\r\n        b.forEach((bi) => {\r\n          aliases.add(bi.get(\"?concept\").value)\r\n          if (bi.get(\"?alias\")) aliases.add(bi.get(\"?alias\"));\r\n        })\r\n      );\r\n\r\n      const concept = {\r\n        aliases: [],\r\n        references: [] \r\n      }\r\n\r\n      for (let v of aliases.values()) {\r\n        concept.aliases.push(v)\r\n        const idQ = `SELECT ?dataset ?dist ?identifier WHERE {\r\n          <${v}> <${LBD.hasReference}> ?ref .\r\n          ?ref <${LBD.inDataset}> ?dataset ;\r\n            <${LBD.hasIdentifier}> ?idUrl .\r\n          ?idUrl <http://schema.org/value> ?identifier ;\r\n            <${LBD.inDistribution}> ?dist .\r\n        }`\r\n        const bindings = await myEngine.query(idQ, {sources: downloadURLs, fetch: this.fetch})\r\n          .then((response: IQueryResultBindings) => response.bindings())\r\n        bindings.map(b => {\r\n          concept.references.push({\r\n            dataset: b.get(\"?dataset\").value,\r\n            distribution: b.get(\"?dist\").value,\r\n            identifier: b.get(\"?identifier\").value\r\n          })\r\n      })\r\n    }\r\n\r\n    const subject = extract(this.data, this.localProject);\r\n    const referenceRegistry = subject[LBD.hasReferenceRegistry][0][\"@id\"];\r\n    const theConcept = new LbdConcept(this.session, referenceRegistry)\r\n    theConcept.init(concept)\r\n    return theConcept\r\n    //     const aliases = {}\r\n    //     asJson[\"results\"].bindings.forEach(item => {\r\n    //       const alias = item[\"alias\"].value\r\n    //       const distribution = item[\"dist\"].value\r\n    //       const dataset = item[\"dataset\"].value\r\n    //       const identifier = item[\"identifier\"].value\r\n\r\n    //       if (!Object.keys(aliases).includes(alias)) {\r\n    //         aliases[alias] = []\r\n    //       }\r\n    // -    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  /////////////////////// QUERY ///////////////////////////\r\n  /////////////////////////////////////////////////////////\r\n\r\n  /**\r\n   * @description a direct query on project resources\r\n   * @param q The SPARQL query (string)\r\n   * @param sources The sources (array)\r\n   * @param asStream Whether to be consumed as a stream or not (default: false)\r\n   * @returns \r\n   */\r\n  public async directQuery(q: string, sources: string[], asStream: boolean = false) {\r\n    const registries = await this.getAllReferenceRegistries()\r\n    const results = await query(q, {sources, fetch: this.fetch, asStream, registries})\r\n    return results\r\n  }\r\n\r\n\r\n  // /**\r\n  //  * @description A query where datasets take the \r\n  //  * @param q \r\n  //  * @param datasets \r\n  //  * @param asStream \r\n  //  */\r\n  // public async indirectQuery(q: string, datasets: string[], asStream: boolean = false) {\r\n\r\n  // }\r\n}\r\n"],"file":"LbdProject.js"}