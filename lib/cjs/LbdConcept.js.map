{"version":3,"sources":["../../src/LbdConcept.ts"],"names":["LbdConcept","session","registry","aliases","fetch","accessService","AccessService","dataService","DataService","references","id","distribution","url","q0","LBD","Concept","sparqlUpdate","push","initialized","data","Error","alias","includes","OWL","sameAs","identifier","dataset","referenceId","regdist","referenceUrl","identifierId","identifierUrl","hasReference","inDataset","hasIdentifier","inDistribution","console","log","isInt","n","startsWith","XSD","anyURI","integer","formatted","string"],"mappings":"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","sourcesContent":["import AccessService from \"./helpers/access-service\";\r\nimport DataService from \"./helpers/data-service\";\r\nimport { newEngine, IQueryResultBindings, ActorInitSparql } from \"@comunica/actor-init-sparql\";\r\n\r\nimport LBD from \"./helpers/vocab/lbds\";\r\nimport { AccessRights, ResourceType } from \"./helpers/BaseDefinitions\";\r\nimport {LbdService} from \"./LbdService\";\r\nimport {extract} from \"./helpers/functions\"\r\nimport {v4} from \"uuid\"\r\nimport { DCAT, DCTERMS, OWL, RDFS, XSD } from \"@inrupt/vocab-common-rdf\";\r\nimport mime from \"mime-types\"\r\nimport { Session as BrowserSession } from \"@inrupt/solid-client-authn-browser\";\r\nimport { Session as NodeSession} from \"@inrupt/solid-client-authn-node\";\r\nimport {LbdProject} from \"./LbdProject\";\r\nimport { getQueryResult } from \"./helpers/utils\";\r\n\r\nexport class LbdConcept {\r\n  public fetch;\r\n  public accessService: AccessService;\r\n  public dataService: DataService;\r\n  private session: BrowserSession | NodeSession\r\n  public references: object[]\r\n  public aliases: string[]\r\n  public registry: string\r\n  public initialized: boolean\r\n\r\n  constructor(session: BrowserSession | NodeSession, registry: string) {\r\n    this.aliases = []\r\n    this.session = session\r\n    this.fetch = session.fetch;\r\n    this.accessService = new AccessService(session.fetch);\r\n    this.dataService = new DataService(session.fetch);\r\n    this.registry = registry\r\n    this.references = []\r\n  }\r\n\r\n  /**\r\n   * create this concept on a project (in a Pod) - asynchronous\r\n   */\r\n  public async create(id?) {\r\n    if (!id) {\r\n      id = v4()\r\n    }\r\n    const distribution = this.registry + 'data'\r\n    const url = distribution + \"#\" + id\r\n    const q0 = `INSERT DATA {<${url}> a <${LBD.Concept}> }`\r\n    await this.dataService.sparqlUpdate(distribution, q0)\r\n    this.aliases.push(url)\r\n    this.initialized = true\r\n  }\r\n\r\n\r\n  /**\r\n   * @description initialise an already existing concept in your application\r\n   * @param data {aliases: string[], references: {dataset, distribution, identifier}[]\r\n   */\r\n  public init(data: {aliases: string[], references: {dataset: string, distribution: string, identifier: string}[]}) {\r\n    this.aliases = data.aliases\r\n    this.references = [data.references]\r\n    this.initialized = true\r\n  }\r\n\r\n  /**\r\n   * @description delete this concept from the reference registry\r\n   */\r\n  public async delete() {\r\n    if (!this.initialized) throw new Error(\"Please initialize the Concept first using this.initialize() or this.create()\")\r\n    const distribution = this.registry + 'data'\r\n    for (const alias  of this.aliases) {\r\n      if (alias.includes(this.registry)) {\r\n        const q0 = `DELETE {\r\n          <${alias}> ?p ?o .\r\n        } WHERE {\r\n          <${alias}> ?p ?o .\r\n        }`\r\n        await this.dataService.sparqlUpdate(distribution, q0)\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  public async addAlias(url) {\r\n    const registry = this.registry\r\n    for (const alias  of this.aliases) {\r\n      if (alias.includes(registry)) {\r\n\r\n        const q0 = `INSERT DATA {\r\n          <${alias}> <${OWL.sameAs}> <${url}> .\r\n       }`\r\n       await this.dataService.sparqlUpdate(this.registry + \"data\", q0)\r\n      }\r\n    }\r\n\r\n    this.aliases.push(url)\r\n    return\r\n  }\r\n\r\n  /**\r\n   * @description Add a reference to this concept\r\n   * @param identifier the identifier\r\n   * @param dataset the dataset that contains this reference\r\n   * @param distribution the distribution that contains this reference\r\n   * @returns \r\n   */\r\n  public async addReference(identifier: string, dataset: string, distribution: string) {\r\n    try {\r\n      if (!this.initialized) throw new Error(\"Please initialize the Concept first using this.initialize() or this.create()\")\r\n      const registry = this.registry\r\n      const referenceId = v4()\r\n      const regdist = registry + \"data\"\r\n      const referenceUrl = regdist + \"#\" + referenceId\r\n      const identifierId = v4()\r\n      const identifierUrl = regdist + \"#\" + identifierId\r\n  \r\n      // const idLiteral = this.getIdentifierType(identifier)\r\n      for (const alias  of this.aliases) {\r\n        if (alias.includes(registry)) {\r\n  \r\n          const q0 = `INSERT DATA {\r\n            <${alias}> <${LBD.hasReference}> <${referenceUrl}> .\r\n            <${referenceUrl}> <${LBD.inDataset}> <${dataset}> ;\r\n              <${LBD.hasIdentifier}> <${identifierUrl}> .\r\n            <${identifierUrl}> <http://schema.org/value> \"${identifier}\" ;\r\n            <${LBD.inDistribution}> <${distribution}> .\r\n         }`\r\n         await this.dataService.sparqlUpdate(regdist, q0)\r\n        }\r\n      }\r\n      this.references.push({\r\n        dataset,\r\n        distribution,\r\n        identifier\r\n      })\r\n      return referenceUrl\r\n    } catch (error) {\r\n      console.log('error', error)\r\n    }\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * @description Delete a reference for this concept\r\n   * @param referenceUrl the URL of the reference to delete\r\n   */\r\n  public async deleteReference(referenceUrl) {\r\n    const regdist = this.registry + \"data\"\r\n    const q0 = `DELETE {\r\n      ?a ?b <${referenceUrl}> .\r\n      <${referenceUrl}> ?p ?o ; ?q ?x.\r\n      ?x ?y ?z.\r\n    } WHERE {\r\n      ?a ?b <${referenceUrl}> .\r\n      <${referenceUrl}> ?p ?o ; ?q ?x.\r\n      ?x ?y ?z.\r\n    }`\r\n    await this.dataService.sparqlUpdate(regdist, q0)\r\n\r\n    // const q1 = `DELETE {<${this.url}> <${LBD.hasReference}> <${referenceUrl}> .}`\r\n    // await this.dataService.sparqlUpdate(regdist, q1)\r\n  }\r\n\r\n  private getIdentifierType(identifier: string | number) {\r\n    function isInt(n) {\r\n      return n % 1 === 0;\r\n   }\r\n\r\n    if (typeof identifier === \"string\" && identifier.startsWith(\"http\")) {\r\n      return `\"${identifier}\"^^<${XSD.anyURI}>`\r\n    } else {\r\n      if (typeof identifier === \"number\") {\r\n        if (isInt(identifier)) {\r\n          return `\"${identifier}\"^^<${XSD.integer}>`\r\n        } else {\r\n          return {formatted: `\"${identifier}\"^^<${XSD.float}>`}\r\n        }\r\n      } else {\r\n        return `\"${identifier}\"^^<${XSD.string}>`\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n"],"file":"LbdConcept.js"}