{"version":3,"sources":["../../../src/helpers/access-service.ts"],"names":["AccessService","fetch","verbose","resourceURL","accessRights","read","append","write","control","setResourceAccess","ResourceType","CONTAINER","FILE","type","userWebID","DATASET","resourceWithAcl","getResourceAcl","resourceAcl","undefined","updatedAcl","newAccess","logAccessInfo","datasetWithAcl","Error","access","resource","agent","console","log","JSON","stringify","controlRead","controlWrite"],"mappings":"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","sourcesContent":["// Import from \"@inrupt/solid-client\"\nimport {\n    getSolidDatasetWithAcl,\n    setPublicResourceAccess,\n    hasResourceAcl,\n    hasAccessibleAcl,\n    getResourceAcl,\n    createAclFromFallbackAcl,\n    hasFallbackAcl,\n    saveAclFor,\n    setAgentResourceAccess,\n    getFileWithAcl\n} from \"@inrupt/solid-client\";\nimport { AccessRights, ResourceType } from \"./BaseDefinitions\";\n\nexport default class AccessService{\n\n    public fetch;\n    public verbose: boolean = false;\n\n    constructor(fetch: any, verbose: boolean = false){\n        this.fetch = fetch;\n        this.verbose = verbose;\n    }\n\n    // Make a resource public\n    public async makePublic(resourceURL: string) {\n        // I would by default not grant the public appending rights...\n        const accessRights: AccessRights = { read: true, append: false, write: false, control: false };\n        return this.setResourceAccess(resourceURL, accessRights, ResourceType.CONTAINER);\n    }\n\n    public async makeFilePublic(resourceURL: string) {\n        const accessRights: AccessRights = { read: true, append: true, write: false, control: false };\n        return this.setResourceAccess(resourceURL, accessRights, ResourceType.FILE);\n    }\n\n    public async setResourceAccess(resourceURL: string, accessRights: AccessRights, type: ResourceType, userWebID?: string){\n\n        // Get resource with ACL\n        let resourceWithAcl: any\n        if(type == ResourceType.DATASET || type == ResourceType.CONTAINER){\n            resourceWithAcl = await getSolidDatasetWithAcl(resourceURL, {fetch: this.fetch});\n        }\n\n        if(type == ResourceType.FILE){\n            resourceWithAcl = await getFileWithAcl(resourceURL, {fetch: this.fetch});\n        }\n        \n        // Get resource ACL\n        const resourceAcl = await this.getResourceAcl(resourceWithAcl);\n        \n        // Update ACL access\n        let updatedAcl;\n\n        // If no user webID provided, set the public access\n        if(!userWebID || userWebID == undefined){\n            updatedAcl = setPublicResourceAccess(\n                resourceAcl,\n                accessRights,\n            );\n        }\n        \n        // If user webID provided, set the access for that particular user\n        else{\n            updatedAcl = setAgentResourceAccess(\n                resourceAcl,\n                userWebID,\n                accessRights,\n            );\n        }\n\n        // Save ACL\n        const newAccess = await saveAclFor(resourceWithAcl, updatedAcl, {fetch: this.fetch});\n\n        this.verbose && this.logAccessInfo(accessRights, resourceURL);\n\n        return newAccess;\n\n    }\n\n    // Obtain the SolidDataset's own ACL, if available,\n    // or initialise a new one, if possible:\n    private async getResourceAcl(datasetWithAcl: any){\n\n        let resourceAcl;\n        if (!hasResourceAcl(datasetWithAcl)) {\n        if (!hasAccessibleAcl(datasetWithAcl)) {\n            throw new Error(\n            \"The current user does not have permission to change access rights to this Resource.\"\n            );\n        }\n        if (!hasFallbackAcl(datasetWithAcl)) {\n            throw new Error(\n            \"The current user does not have permission to see who currently has access to this Resource.\"\n            );\n            // Alternatively, initialise a new empty ACL as follows,\n            // but be aware that if you do not give someone Control access,\n            // **nobody will ever be able to change Access permissions in the future**:\n            // resourceAcl = createAcl(myDatasetWithAcl);\n        }\n            resourceAcl = createAclFromFallbackAcl(datasetWithAcl);\n        } else {\n            resourceAcl = getResourceAcl(datasetWithAcl);\n        }\n\n        return resourceAcl;\n    }\n\n    private logAccessInfo(access: any, resource: string, agent: string = \"\"){\n        if (access === null) {\n            console.log(\"Could not load access details for this Resource.\");\n        } else {\n            if(!agent) console.log(`${agent}'s Access:: `, JSON.stringify(access));\n            else console.log(`Public Access:: `, JSON.stringify(access));\n            console.log(\"...\", agent, (access.read ? 'CAN' : 'CANNOT'), \"read the Resource\", resource);\n            console.log(\"...\", agent, (access.append ? 'CAN' : 'CANNOT'), \"add data to the Resource\", resource);\n            console.log(\"...\", agent, (access.write ? 'CAN' : 'CANNOT'), \"change data in the Resource\", resource);\n\n            if ('controlRead' in access){\n                console.log(\"...\", agent, (access.controlRead ? 'CAN' : 'CANNOT'), \"see access to the Resource\", resource);\n                console.log(\"...\", agent, (access.controlWrite ? 'CAN' : 'CANNOT'), \"change access to the Resource\", resource);\n            }else{\n                console.log(\"...\", agent, (access.control ? 'CAN' : 'CANNOT'), \"change access to the Resource\", resource);\n            }\n\n        }\n    }\n\n}"],"file":"access-service.js"}